# Code Review - RFID Library Terminal

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Race Condition –≤ `StartBookFlowIfFree` (MainForm.cs:751-776)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `_bookScanBusy` –Ω–µ –∞—Ç–æ–º–∞—Ä–Ω—ã, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –∫–Ω–∏–≥–∏.

```csharp
if (_bookScanBusy) return;  // ‚Üê –ø—Ä–æ–≤–µ—Ä–∫–∞
_bookScanBusy = true;        // ‚Üê —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–Ω–µ –∞—Ç–æ–º–∞—Ä–Ω–æ!)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
if (Interlocked.CompareExchange(ref _bookScanBusy, 1, 0) != 0) return;
try {
    // ... –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ...
} finally {
    Interlocked.Exchange(ref _bookScanBusy, 0);
}
```

### 2. –ü–æ—Ç–µ—Ä—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ `ContinueWith` (MainForm.cs:772-775)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `ContinueWith` –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã, –∏ `_bookScanBusy` –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è `true`.

```csharp
).ContinueWith(__ => { _bookScanBusy = false; });
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
).ContinueWith(t => { 
    _bookScanBusy = false;
    if (t.IsFaulted) {
        Logger.Append("irbis.log", $"Book flow exception: {t.Exception}");
    }
}, TaskContinuationOptions.ExecuteSynchronously);
```

### 3. –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤ –≤ async –º–µ—Ç–æ–¥–µ (MainForm.cs:85)

**–ü—Ä–æ–±–ª–µ–º–∞:** `Task.Delay(...).Wait(ct)` –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –≤ async –º–µ—Ç–æ–¥–µ.

```csharp
if (periodMs > 0) { try { Task.Delay(periodMs, ct).Wait(ct); } catch { } }
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
if (periodMs > 0) { 
    try { await Task.Delay(periodMs, ct); } catch (OperationCanceledException) { } 
}
```

### 4. `async void` –≤ `OnShown` (MainForm.cs:273)

**–ü—Ä–æ–±–ª–µ–º–∞:** `async void` —Å–∫—Ä—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫—Ä–∞—Ö—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

```csharp
protected override async void OnShown(EventArgs e)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
protected override void OnShown(EventArgs e)
{
    base.OnShown(e);
    _ = InitIrbisWithRetryAsync().ContinueWith(t => {
        if (t.IsFaulted) {
            Logger.Append("irbis.log", $"IRBIS init failed: {t.Exception}");
        }
    }, TaskContinuationOptions.ExecuteSynchronously);
}
```

### 5. –£—Ç–µ—á–∫–∞ Timer (MainForm.cs:152)

**–ü—Ä–æ–±–ª–µ–º–∞:** `WinFormsTimer _tick` –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –≤ `OnFormClosing`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
protected override void OnFormClosing(FormClosingEventArgs e)
{
    _tick?.Stop();
    _tick?.Dispose();
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
}
```

### 6. –í–æ–∑–º–æ–∂–Ω—ã–π NullReferenceException (MainForm.cs:704)

**–ü—Ä–æ–±–ª–µ–º–∞:** `_svc.LastReaderMfn` –º–æ–∂–µ—Ç –±—ã—Ç—å 0, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏.

```csharp
string readerBrief = await SafeGetReaderBriefAsync(_svc.LastReaderMfn);
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
int readerMfn = _svc?.LastReaderMfn ?? 0;
if (readerMfn <= 0) return;
string readerBrief = await SafeGetReaderBriefAsync(readerMfn);
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 7. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–æ—Ä–º–µ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ (MainForm.cs:686-794)

**–ü—Ä–æ–±–ª–µ–º–∞:** `BeginInvoke` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ñ–æ—Ä–º–∞ –Ω–µ disposed.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
private void OnAnyCardUid(string rawUid, string source)
{
    if (IsDisposed || Disposing) return;
    if (InvokeRequired) { 
        if (IsDisposed || Disposing) return;
        BeginInvoke(new Action<string, string>(OnAnyCardUid), rawUid, source); 
        return; 
    }
    // ...
}
```

### 8. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Task.Run` (MainForm.cs:215-216)

**–ü—Ä–æ–±–ª–µ–º–∞:** `Task.Run` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ª–∏—à–Ω–∏–µ –ø–æ—Ç–æ–∫–∏.

```csharp
private static Task OffUi(Action a) => Task.Run(a);
private static Task<T> OffUi<T>(Func<T> f) => Task.Run(f);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –î–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Task.FromResult` –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤.

### 9. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –≤ `SerialWorker` (SerialWorker.cs:259-264)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ –≤ `OnData` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `Stop()` –∏ `Start()`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–µ–∫—É—Ä—Å–∏–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
catch (Exception ex)
{
    try { OnClosed(ex); } catch { }
    // –ù–µ –≤—ã–∑—ã–≤–∞—Ç—å Stop/Start –∑–¥–µ—Å—å - —ç—Ç–æ —Å–¥–µ–ª–∞–µ—Ç WorkerLoop
    // –ü—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
}
```

### 10. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Å–æ–±—ã—Ç–∏—è–º–∏ (Devices.cs:98, Rru9816Reader.cs:162)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å null, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `?.Invoke` –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–¥–ø–∏—Å—á–∏–∫ –Ω–µ –æ—Ç–ø–∏—à–µ—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –≤—ã–∑–æ–≤–æ–º.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```csharp
OnUid?.Invoke(uid);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–µ–ª–µ–≥–∞—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
```csharp
var handler = OnUid;
handler?.Invoke(uid);
```

### 11. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ disposed –≤ `ArduinoClientSerial.Request` (Devices.cs:326-344)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –ø–æ—Å–ª–µ dispose, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –∏—Å–∫–ª—é—á–µ–Ω–∏—é.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
public bool HasSpace()
{
    if (!IsOpen) return false; // –∏–ª–∏ throw ObjectDisposedException
    var resp = Request("SPACE?", _syncTimeoutMs);
    // ...
}
```

### 12. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å `_lastResp` (Devices.cs:207-211)

**–ü—Ä–æ–±–ª–µ–º–∞:** `_lastResp` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ `Request` –µ–≥–æ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç, –µ—Å–ª–∏ –ø—Ä–∏–¥–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –æ—Ç–≤–µ—Ç–æ–≤ –∏–ª–∏ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.

## üìù –£–ª—É—á—à–µ–Ω–∏—è –∫–æ–¥–∞

### 13. –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø—É—Å—Ç—ã—Ö catch –±–ª–æ–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–µ—Ä—è—é—Ç—Å—è –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
```csharp
catch (Exception ex) 
{ 
    Logger.Append("error.log", $"Error in {methodName}: {ex}"); 
}
```

### 14. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –º–Ω–æ–≥–æ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª (300, 100, 250, –∏ —Ç.–¥.).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

### 15. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–∏–≥ –≤ `HandleTakeAsync` –∏ `HandleReturnAsync` —á–∞—Å—Ç–∏—á–Ω–æ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.

### 16. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (IrbisServiceManaged.cs)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ `WithDatabase`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –±–∞–∑—É –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

### 17. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ null/–ø—É—Å—Ç–æ—Ç—É.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –º–µ—Ç–æ–¥–æ–≤:
```csharp
public bool ValidateCard(string uid)
{
    if (string.IsNullOrWhiteSpace(uid)) 
        throw new ArgumentException("UID cannot be null or empty", nameof(uid));
    // ...
}
```

### 18. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å `NormalizeId` (IrbisServiceManaged.cs:110-116)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å null, –Ω–æ –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ –Ω–µ –≤—Å–µ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ null –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å nullable —Ç–∏–ø—ã —è–≤–Ω–æ.

### 19. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å `ManagedClient64` (IrbisServiceManaged.cs)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å lock –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å thread-safe –∫–ª–∏–µ–Ω—Ç.

### 20. –ü—Ä–æ–±–ª–µ–º–∞ —Å `_tick.Enabled` (MainForm.cs:629)

**–ü—Ä–æ–±–ª–µ–º–∞:** Timer –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–æ—Å–ª–µ dispose —Ñ–æ—Ä–º—ã.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```csharp
if (timeoutSeconds.HasValue)
{
    _deadline = DateTime.Now.AddSeconds(timeoutSeconds.Value);
    if (!IsDisposed && !Disposing)
        _tick.Enabled = true;
}
```

## üîí –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 21. –ü–∞—Ä–æ–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (App.config:14)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ Windows Credential Store.

### 22. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ –æ—Ç RFID-—Ä–∏–¥–µ—Ä–æ–≤ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –Ω–∞ –¥–ª–∏–Ω—É/—Ñ–æ—Ä–º–∞—Ç.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 23. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ (EpcParser.cs:53-55)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `Substring` –≤ —Ü–∏–∫–ª–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Span<char>` –∏–ª–∏ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥.

### 24. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã `FormatRecord` (IrbisServiceManaged.cs)

**–ü—Ä–æ–±–ª–µ–º–∞:** `FormatRecord` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. ‚úÖ –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ async/await (—Ö–æ—Ç—è –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã)
3. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
4. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
5. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∏–¥–µ—Ä–æ–≤
6. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ App.config

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):**
- –ü—Ä–æ–±–ª–µ–º—ã 1, 2, 3, 4, 5, 6

**–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):**
- –ü—Ä–æ–±–ª–µ–º—ã 7, 8, 9, 10, 11, 12

**–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–ª—É—á—à–µ–Ω–∏—è):**
- –ü—Ä–æ–±–ª–µ–º—ã 13-24

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

1. –†–∞–∑–¥–µ–ª–∏—Ç—å `MainForm.cs` –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–æ–≤ (UI, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ò–†–ë–ò–°
3. –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dependency injection –¥–ª—è –ª—É—á—à–µ–π —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏
5. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤—Å–µ—Ö —Ä–∏–¥–µ—Ä–æ–≤
6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CancellationToken –¥–ª—è –≤—Å–µ—Ö –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
